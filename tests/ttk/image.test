#
# Tests for images in various ttk widgets
#

# NOTES
#
# * The ttk test suite holds many tests that build upon a previous one. This
#   is not incidental; it occurs systematically for groups of contiguous tests
#   in most ttk test files.
#
#   A consequence of this practice is that attempts to run tests selectively/
#   individually using the tcltest options "-match", "-skip" or "-limitconstraints 1"
#   lead to unintended failures. Therefore, invocations using these options
#   may be considered invalid for the ttk test suite (but not for the
#   corresponding core Tk tests).
#

#
# TESTFILE INITIALIZATION
#

package require tcltest 2.2; # needed in mode -singleproc 0

# Load the main script main.tcl, which takes care of:
# - setup for the application and the root window
# - importing commands from the tcltest namespace
# - loading of the testutils mechanism along with its utility procs
# - loading of Tk specific test constraints (additionally to constraints
#   provided by the package tcltest)
source [file join [file dirname [tcltest::configure -testdir]] main.tcl]

# Ensure a pristine initial window state
resetWindows

#
# TESTS
#

test image-1.1 "Bad image element" -body {
    ttk::style element create BadImage image badimage
} -returnCodes error -result {image "badimage" does not exist}

test image-1.2 "Duplicate element" -setup {
    image create photo test.element -width 10 -height 10
    ttk::style element create testElement image test.element
} -body {
    ttk::style element create testElement image test.element
} -returnCodes error -result "Duplicate element testElement"

test image-2.0 "Deletion of displayed image (label)" -setup {
     image create photo test.image -width 10 -height 10
} -body {
    pack [set w [ttk::label .ttk_image20 -image test.image]]
    tkwait visibility $w
    image delete test.image
    update
} -cleanup {
    destroy .ttk_image20
} -result {}

test image-2.1 "Deletion of displayed image (checkbutton)" -setup {
     image create photo test.image -width 10 -height 10
} -body {
    pack [set w [ttk::checkbutton .ttk_image21 -image test.image]]
    tkwait visibility $w
    image delete test.image
    update
} -cleanup {
    destroy .ttk_image21
} -result {}

test image-2.2 "Deletion of displayed image (radiobutton)" -setup {
     image create photo test.image -width 10 -height 10
} -body {
    pack [set w [ttk::radiobutton .ttk_image22 -image test.image]]
    tkwait visibility $w
    image delete test.image
    update
} -cleanup {
    destroy .ttk_image22
} -result {}

#
# TESTFILE CLEANUP
#

tcltest::cleanupTests
